<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ç‰©ç†å¼•æ“éŠæ¨‚å ´</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        #info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: Arial;
        }
    </style>
</head>
<body>
    <div id="info">ç‰©é«”æ•¸é‡: 0 | FPS: 0</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script>
        const Engine = Matter.Engine,
            Render = Matter.Render,
            Runner = Matter.Runner,
            Bodies = Matter.Bodies,
            Composite = Matter.Composite,
            Mouse = Matter.Mouse,
            Events = Matter.Events,
            MouseConstraint = Matter.MouseConstraint,
            Constraint = Matter.Constraint;

        // æ·»åŠ  emoji åœ–ç‰‡è½‰æ›å‡½æ•¸
        function emojiToImage(emoji, size) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = size;
            canvas.height = size;
            
            ctx.font = `${size}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(emoji, size/2, size/2);
            
            return canvas.toDataURL();
        }

        // é è¨­çš„ emoji åˆ—è¡¨
        const emojis = ['ğŸˆ', 'âš½', 'ğŸ±', 'ğŸŒŸ', 'ğŸ®', 'ğŸ²'];

        // å‰µå»ºå¼•æ“
        const engine = Engine.create();
        
        // å‰µå»ºæ¸²æŸ“å™¨
        const render = Render.create({
            element: document.body,
            engine: engine,
            options: {
                width: window.innerWidth,
                height: window.innerHeight,
                wireframes: false
            }
        });

        // å‰µå»ºæ»‘é¼ æ§åˆ¶
        const mouse = Mouse.create(render.canvas);
        const mouseConstraint = MouseConstraint.create(engine, {
            mouse: mouse,
            constraint: {
                stiffness: 0.2,
                render: {
                    visible: false
                }
            }
        });

        // æ·»åŠ æ»‘é¼ æ§åˆ¶åˆ°ä¸–ç•Œ
        Composite.add(engine.world, mouseConstraint);
        render.mouse = mouse;

        // å‰µå»ºé‚Šç•Œ
        const walls = [
            Bodies.rectangle(window.innerWidth/2, -10, window.innerWidth, 20, { isStatic: true }),
            Bodies.rectangle(window.innerWidth/2, window.innerHeight+10, window.innerWidth, 20, { isStatic: true }),
            Bodies.rectangle(-10, window.innerHeight/2, 20, window.innerHeight, { isStatic: true }),
            Bodies.rectangle(window.innerWidth+10, window.innerHeight/2, 20, window.innerHeight, { isStatic: true })
        ];
        Composite.add(engine.world, walls);

        // å•Ÿå‹•æ¸²æŸ“å™¨å’Œå¼•æ“
        Render.run(render);
        const runner = Runner.create();
        Runner.run(runner, engine);

        // FPSè¨ˆç®—
        let frameCount = 0;
        let fps = 0;
        let lastTime = performance.now();
        
        // æ»‘é¼ ç‹€æ…‹
        let isMouseDown = false;
        let spawnInterval;

        // é¡è‰²æ§åˆ¶
        let currentHue = 0;
        const hueStep = 0.1; // å¾ 5 æ”¹ç‚º 1ï¼Œè®“é¡è‰²è®ŠåŒ–æ›´ç·©æ…¢

        // éš¨æ©Ÿé¡è‰²ç”Ÿæˆ
        function getRandomColor() {
            // æ›´æ–°è‰²ç›¸å€¼ï¼ˆ0-360åº¦å¾ªç’°ï¼‰
            currentHue = (currentHue + hueStep) % 360;
            // ä½¿ç”¨ç¨å¾®éš¨æ©Ÿçš„é£½å’Œåº¦å’Œäº®åº¦ï¼Œä½†ä¿æŒè‰²ç›¸æ¼¸è®Š
            const saturation = 80 + Math.random() * 20; // 80-100%
            const lightness = 45 + Math.random() * 10;  // 45-55%
            return `hsl(${currentHue}, ${saturation}%, ${lightness}%)`;
        }

        // éš¨æ©Ÿå½¢ç‹€ç”Ÿæˆ
        function createRandomBody(x, y) {
            const size = 30 + Math.random() * 30;
            const emoji = emojis[Math.floor(Math.random() * emojis.length)];
            const imageUrl = emojiToImage(emoji, size);
            
            const shapes = [
                () => Bodies.circle(x, y, size/2, {
                    render: {
                        sprite: {
                            texture: imageUrl,
                            xScale: 1,
                            yScale: 1
                        }
                    }
                }),
                () => Bodies.rectangle(x, y, size, size, {
                    render: {
                        sprite: {
                            texture: imageUrl,
                            xScale: 1,
                            yScale: 1
                        }
                    }
                })
            ];
            return shapes[Math.floor(Math.random() * shapes.length)]();
        }

        // æ»‘é¼ äº‹ä»¶
        document.addEventListener('mousedown', (e) => {
            const mousePosition = mouse.position;
            const bodiesUnderMouse = Matter.Query.point(
                Composite.allBodies(engine.world), 
                mousePosition
            );
            
            // å¦‚æœæ»‘é¼ ä¸‹æ–¹æ²’æœ‰ç‰©é«”ï¼ˆæ’é™¤é‚Šç•Œï¼‰ï¼Œå‰‡é–‹å§‹ç”Ÿæˆç‰©é«”
            if (bodiesUnderMouse.length === 0 || 
                bodiesUnderMouse.every(body => body.isStatic)) {
                isMouseDown = true;
                spawnInterval = setInterval(() => {
                    const body = createRandomBody(e.clientX, e.clientY);
                    Composite.add(engine.world, body);
                }, 1);
            }
        });

        document.addEventListener('mousemove', (e) => {
            if (isMouseDown && !mouseConstraint.body) {
                const body = createRandomBody(e.clientX, e.clientY);
                Composite.add(engine.world, body);
            }
        });

        document.addEventListener('mouseup', () => {
            isMouseDown = false;
            clearInterval(spawnInterval);
        });

        // éµç›¤äº‹ä»¶ - ç©ºç™½éµç”Ÿæˆç‰©é«”
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                // ç”Ÿæˆ10å€‹éš¨æ©Ÿä½ç½®çš„ç‰©é«”
                for (let i = 0; i < 10; i++) {
                    const x = Math.random() * window.innerWidth;
                    const y = Math.random() * window.innerHeight;
                    const body = createRandomBody(x, y);
                    Composite.add(engine.world, body);
                }
            }
        });

        // æ›´æ–°è³‡è¨Šé¡¯ç¤º
        setInterval(() => {
            frameCount++;
            const currentTime = performance.now();
            if (currentTime - lastTime >= 1000) {
                fps = Math.round(frameCount * 1000 / (currentTime - lastTime));
                frameCount = 0;
                lastTime = currentTime;
            }
            
            const bodyCount = Composite.allBodies(engine.world).length - 4; // æ¸›å»4å€‹é‚Šç•Œ
            document.getElementById('info').textContent = 
                `ç‰©é«”æ•¸é‡: ${bodyCount} | FPS: ${fps}`;
        }, 100);
    </script>
</body>
</html>
